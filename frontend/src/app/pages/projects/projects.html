<div class="projects-container">
  <!-- Header Section -->
  <div class="projects-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">Projects</h1>
        <p class="page-subtitle">
          Showing {{ totalProjects }} project{{ totalProjects !== 1 ? 's' : '' }}
          <span *ngIf="filterCount > 0" class="filtered-count">({{ projects.length }} filtered)</span>
        </p>
      </div>
      <div class="header-right">
        <button class="btn btn-secondary" (click)="refreshProjects()" [disabled]="isLoading">
          <i class="fas fa-sync-alt" [class.spinning]="isLoading"></i>
          Refresh
        </button>
        <button class="btn btn-secondary" (click)="exportAll()" [disabled]="isExporting">
          <i class="fas fa-download"></i>
          Export All
        </button>
        <button class="btn btn-primary" routerLink="/project-details/new">
          <i class="fas fa-plus"></i>
          New Project
        </button>
      </div>
    </div>

    <!-- Summary Stats Bar -->
    <div class="summary-stats" *ngIf="!isLoading && projects.length > 0">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-project-diagram"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ totalProjects }}</div>
          <div class="stat-label">Total Projects</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon active">
          <i class="fas fa-play-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ activeProjects }}</div>
          <div class="stat-label">Active</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon completed">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ completedProjects }}</div>
          <div class="stat-label">Completed</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon budget">
          <i class="fas fa-rupee-sign"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatCurrency(totalBudget) }}</div>
          <div class="stat-label">Total Budget</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toolbar Section -->
  <div class="projects-toolbar">
    <div class="toolbar-left">
      <!-- Search Bar -->
      <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input
          type="text"
          class="search-input"
          placeholder="Search by project name, client, location..."
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange($event)"
        />
        <button *ngIf="searchQuery" class="clear-search" (click)="clearSearch()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Filter Button -->
      <button
        class="btn btn-filter"
        [class.active]="filterCount > 0"
        (click)="toggleFilterDrawer()"
      >
        <i class="fas fa-filter"></i>
        Filters
        <span *ngIf="filterCount > 0" class="filter-badge">{{ filterCount }}</span>
      </button>

      <!-- Quick Filter Chips -->
      <div class="quick-filters">
        <button class="chip-btn" (click)="showMyProjects()">
          <i class="fas fa-user"></i> My Projects
        </button>
        <button class="chip-btn" (click)="showActiveProjects()">
          <i class="fas fa-play"></i> Active
        </button>
        <button class="chip-btn" (click)="showCompletedProjects()">
          <i class="fas fa-check"></i> Completed
        </button>
      </div>
    </div>

    <div class="toolbar-right">
      <!-- Sort Dropdown -->
      <div class="sort-control">
        <label>Sort by:</label>
        <select
          class="sort-select"
          [value]="currentSort.sortBy + '-' + currentSort.sortOrder"
          (change)="onSortChange($any($event.target).value)"
        >
          <option *ngFor="let option of sortOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <!-- View Toggle -->
      <div class="view-toggle">
        <button
          class="view-btn"
          [class.active]="currentView === 'grid'"
          (click)="setView('grid')"
          title="Grid View"
        >
          <i class="fas fa-th"></i>
        </button>
        <button
          class="view-btn"
          [class.active]="currentView === 'list'"
          (click)="setView('list')"
          title="List View"
        >
          <i class="fas fa-list"></i>
        </button>
        <button
          class="view-btn"
          [class.active]="currentView === 'map'"
          (click)="setView('map')"
          title="Map View"
        >
          <i class="fas fa-map-marked-alt"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Active Filters Display -->
  <div class="active-filters" *ngIf="filterCount > 0">
    <div class="active-filters-header">
      <span class="filter-label">Active Filters:</span>
      <button class="btn-link" (click)="clearAllFilters()">Clear All</button>
    </div>
    <div class="filter-chips">
      <span
        *ngFor="let status of selectedStatuses"
        class="filter-chip"
        [style.background]="getStatusBadgeColor(status)"
      >
        {{ status }}
        <i class="fas fa-times" (click)="removeFilter('status', status)"></i>
      </span>
      <span *ngFor="let type of selectedTypes" class="filter-chip">
        {{ type === 'farm' ? 'Farm' : 'Landscaping' }}
        <i class="fas fa-times" (click)="removeFilter('type', type)"></i>
      </span>
      <span *ngFor="let member of selectedTeamMembers" class="filter-chip">
        {{ member }}
        <i class="fas fa-times" (click)="removeFilter('assignedTo', member)"></i>
      </span>
      <span *ngIf="selectedCity" class="filter-chip">
        {{ selectedCity }}
        <i class="fas fa-times" (click)="removeFilter('city')"></i>
      </span>
      <span *ngIf="budgetMin || budgetMax" class="filter-chip">
        Budget: {{ formatCurrency(budgetMin || 0) }} - {{ formatCurrency(budgetMax || 999999999) }}
        <i class="fas fa-times" (click)="removeFilter('budget')"></i>
      </span>
      <span *ngIf="showFavoritesOnly" class="filter-chip">
        Favorites Only
        <i class="fas fa-times" (click)="removeFilter('favorites')"></i>
      </span>
    </div>
  </div>

  <!-- Filter Drawer -->
  <div class="filter-drawer" [class.open]="showFilterDrawer">
    <div class="filter-drawer-overlay" (click)="toggleFilterDrawer()"></div>
    <div class="filter-drawer-content">
      <div class="filter-drawer-header">
        <h3>Filters</h3>
        <button class="btn-close" (click)="toggleFilterDrawer()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="filter-drawer-body">
        <!-- Project Status Filter -->
        <div class="filter-section">
          <label class="filter-label">Project Status</label>
          <div class="checkbox-group">
            <label *ngFor="let status of statusOptions" class="checkbox-label">
              <input
                type="checkbox"
                [checked]="selectedStatuses.includes(status)"
                (change)="toggleArrayFilter(selectedStatuses, status)"
              />
              <span class="status-dot" [style.background]="getStatusBadgeColor(status)"></span>
              {{ status }}
            </label>
          </div>
        </div>

        <!-- Project Type Filter -->
        <div class="filter-section">
          <label class="filter-label">Project Type</label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                [checked]="selectedTypes.includes('farm')"
                (change)="toggleArrayFilter(selectedTypes, 'farm')"
              />
              <i class="fas fa-tractor"></i>
              Farm Projects
            </label>
            <label class="checkbox-label">
              <input
                type="checkbox"
                [checked]="selectedTypes.includes('landscaping')"
                (change)="toggleArrayFilter(selectedTypes, 'landscaping')"
              />
              <i class="fas fa-leaf"></i>
              Landscaping Projects
            </label>
          </div>
        </div>

        <!-- Team Member Filter -->
        <div class="filter-section">
          <label class="filter-label">Assigned Team</label>
          <div class="checkbox-group">
            <label *ngFor="let member of teamMembers" class="checkbox-label">
              <input
                type="checkbox"
                [checked]="selectedTeamMembers.includes(member)"
                (change)="toggleArrayFilter(selectedTeamMembers, member)"
              />
              {{ member }}
            </label>
          </div>
        </div>

        <!-- Location Filter -->
        <div class="filter-section">
          <label class="filter-label">Location</label>
          <select class="filter-select" [(ngModel)]="selectedCity">
            <option value="">All Cities</option>
            <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
          </select>
        </div>

        <!-- Budget Range Filter -->
        <div class="filter-section">
          <label class="filter-label">Budget Range</label>
          <div class="range-inputs">
            <input
              type="number"
              class="filter-input"
              placeholder="Min Budget"
              [(ngModel)]="budgetMin"
            />
            <span class="range-separator">to</span>
            <input
              type="number"
              class="filter-input"
              placeholder="Max Budget"
              [(ngModel)]="budgetMax"
            />
          </div>
        </div>

        <!-- Favorites Only -->
        <div class="filter-section">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="showFavoritesOnly" />
            <i class="fas fa-star"></i>
            Show Favorites Only
          </label>
        </div>
      </div>

      <div class="filter-drawer-footer">
        <button class="btn btn-secondary btn-block" (click)="clearFilters()">
          Clear Filters
        </button>
        <button class="btn btn-primary btn-block" (click)="applyFilters()">
          Apply Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Bulk Actions Toolbar -->
  <div class="bulk-actions-toolbar" *ngIf="showBulkActions">
    <div class="bulk-actions-content">
      <div class="bulk-selection-info">
        <input
          type="checkbox"
          class="bulk-checkbox"
          [checked]="allSelected"
          [indeterminate]="someSelected"
          (change)="toggleSelectAll($event)"
        />
        <span class="selection-count">{{ selectedProjects.size }} selected</span>
      </div>
      <div class="bulk-actions-buttons">
        <button class="btn btn-secondary btn-sm" (click)="bulkExport()" [disabled]="bulkActionInProgress">
          <i class="fas fa-download"></i>
          Export
        </button>
        <button class="btn btn-secondary btn-sm" (click)="bulkArchive()" [disabled]="bulkActionInProgress">
          <i class="fas fa-archive"></i>
          Archive
        </button>
        <button class="btn btn-danger btn-sm" (click)="bulkDelete()" [disabled]="bulkActionInProgress">
          <i class="fas fa-trash"></i>
          Delete
        </button>
        <button class="btn btn-link btn-sm" (click)="clearSelection()">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="projects-content">
    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="skeleton-grid" *ngIf="currentView === 'grid'">
        <div class="skeleton-card" *ngFor="let i of [1, 2, 3, 4, 5, 6]">
          <div class="skeleton-image"></div>
          <div class="skeleton-line"></div>
          <div class="skeleton-line short"></div>
        </div>
      </div>
      <div class="spinner-container" *ngIf="currentView !== 'grid'">
        <i class="fas fa-spinner fa-spin fa-3x"></i>
        <p>Loading projects...</p>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading && showEmptyState">
      <i class="fas fa-folder-open fa-5x empty-icon"></i>
      <h3>{{ emptyStateMessage }}</h3>
      <p *ngIf="filterCount > 0 || searchQuery">
        Try adjusting your filters or search query
      </p>
      <button *ngIf="filterCount > 0 || searchQuery" class="btn btn-secondary" (click)="clearAllFilters()">
        Clear All Filters
      </button>
      <button *ngIf="!filterCount && !searchQuery" class="btn btn-primary" routerLink="/project-details/new">
        Create Your First Project
      </button>
    </div>

    <!-- Grid View -->
    <div class="projects-grid" *ngIf="!isLoading && !showEmptyState && currentView === 'grid'">
      <div
        *ngFor="let project of projects"
        class="project-card"
        [class.selected]="isSelected(project.id)"
        (click)="viewProject(project.id)"
      >
        <!-- Selection Checkbox -->
        <div class="card-checkbox" (click)="toggleSelection(project.id, $event)">
          <input type="checkbox" [checked]="isSelected(project.id)" />
        </div>

        <!-- Favorite Star -->
        <button
          class="favorite-btn"
          [class.active]="project.isFavorite"
          (click)="toggleFavorite(project, $event)"
        >
          <i class="fas fa-star"></i>
        </button>

        <!-- Project Cover Image -->
        <div class="card-image">
          <img
            [src]="project.coverImage || 'assets/images/default-project.jpg'"
            [alt]="project.name"
            onerror="this.src='assets/images/default-project.jpg'"
          />
          <div class="image-overlay">
            <div class="overlay-badges">
              <span class="type-badge" [class.farm]="project.type === 'farm'">
                <i [class]="project.type === 'farm' ? 'fas fa-tractor' : 'fas fa-leaf'"></i>
                {{ project.type === 'farm' ? 'Farm' : 'Landscaping' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Card Content -->
        <div class="card-content">
          <!-- Project Name & Status -->
          <div class="card-header">
            <h3 class="project-name">{{ project.name }}</h3>
            <span
              class="status-badge"
              [style.background]="getStatusBadgeColor(project.status)"
            >
              {{ project.status }}
            </span>
          </div>

          <!-- Client Info -->
          <div class="card-meta">
            <div class="meta-item">
              <img
                [src]="project.clientAvatar || 'https://ui-avatars.com/api/?name=' + project.client"
                [alt]="project.client"
                class="client-avatar"
              />
              <span class="client-name">{{ project.client }}</span>
            </div>
          </div>

          <!-- Location & Size -->
          <div class="card-info">
            <div class="info-item">
              <i class="fas fa-map-marker-alt"></i>
              <span>{{ project.location }}</span>
            </div>
            <div class="info-item">
              <i class="fas fa-ruler-combined"></i>
              <span>{{ formatSize(project.size, project.sizeUnit) }}</span>
            </div>
          </div>

          <!-- Progress Indicators -->
          <div class="card-progress">
            <div class="progress-item">
              <div class="progress-label">
                <span>Visit Progress</span>
                <span class="progress-value">{{ project.visitCompletionPercent || 0 }}%</span>
              </div>
              <div class="progress-bar">
                <div
                  class="progress-fill visit"
                  [style.width.%]="project.visitCompletionPercent || 0"
                ></div>
              </div>
            </div>
            <div class="progress-item">
              <div class="progress-label">
                <span>Budget Used</span>
                <span class="progress-value">{{ project.budgetUtilizationPercent || 0 }}%</span>
              </div>
              <div class="progress-bar">
                <div
                  class="progress-fill budget"
                  [style.width.%]="project.budgetUtilizationPercent || 0"
                ></div>
              </div>
            </div>
          </div>

          <!-- Card Footer -->
          <div class="card-footer">
            <div class="budget-info">
              <span class="budget-label">Budget:</span>
              <span class="budget-value">{{ formatCurrency(project.budget) }}</span>
            </div>
            <div class="time-info">
              <i class="fas fa-clock"></i>
              <span>{{ getTimeAgo(project.updatedAt) }}</span>
            </div>
          </div>
        </div>

        <!-- Quick Actions (on hover) -->
        <div class="card-actions">
          <button class="action-btn" (click)="viewProject(project.id); $event.stopPropagation()">
            <i class="fas fa-eye"></i>
            View
          </button>
          <button class="action-btn" routerLink="/project-details/{{project.id}}/edit" (click)="$event.stopPropagation()">
            <i class="fas fa-edit"></i>
            Edit
          </button>
        </div>
      </div>
    </div>

    <!-- List View -->
    <div class="projects-list" *ngIf="!isLoading && !showEmptyState && currentView === 'list'">
      <div class="list-header">
        <div class="list-cell checkbox-cell">
          <input
            type="checkbox"
            [checked]="allSelected"
            [indeterminate]="someSelected"
            (change)="toggleSelectAll($event)"
          />
        </div>
        <div class="list-cell name-cell">Name</div>
        <div class="list-cell client-cell">Client</div>
        <div class="list-cell location-cell">Location</div>
        <div class="list-cell status-cell">Status</div>
        <div class="list-cell budget-cell">Budget</div>
        <div class="list-cell updated-cell">Updated</div>
        <div class="list-cell actions-cell">Actions</div>
      </div>

      <div
        *ngFor="let project of projects"
        class="list-row"
        [class.selected]="isSelected(project.id)"
        (click)="viewProject(project.id)"
      >
        <div class="list-cell checkbox-cell" (click)="toggleSelection(project.id, $event)">
          <input type="checkbox" [checked]="isSelected(project.id)" />
        </div>
        <div class="list-cell name-cell">
          <i [class]="project.type === 'farm' ? 'fas fa-tractor' : 'fas fa-leaf'" class="type-icon"></i>
          <span class="project-name">{{ project.name }}</span>
          <i *ngIf="project.isFavorite" class="fas fa-star favorite-icon"></i>
        </div>
        <div class="list-cell client-cell">
          <img
            [src]="project.clientAvatar || 'https://ui-avatars.com/api/?name=' + project.client"
            [alt]="project.client"
            class="client-avatar-small"
          />
          {{ project.client }}
        </div>
        <div class="list-cell location-cell">{{ project.location }}</div>
        <div class="list-cell status-cell">
          <span class="status-badge-small" [style.background]="getStatusBadgeColor(project.status)">
            {{ project.status }}
          </span>
        </div>
        <div class="list-cell budget-cell">{{ formatCurrency(project.budget) }}</div>
        <div class="list-cell updated-cell">{{ getTimeAgo(project.updatedAt) }}</div>
        <div class="list-cell actions-cell">
          <button class="action-btn-small" (click)="toggleFavorite(project, $event)">
            <i class="fas fa-star" [class.active]="project.isFavorite"></i>
          </button>
          <button class="action-btn-small" routerLink="/project-details/{{project.id}}/edit" (click)="$event.stopPropagation()">
            <i class="fas fa-edit"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Map View -->
    <div class="projects-map" *ngIf="!isLoading && !showEmptyState && currentView === 'map'">
      <div class="map-placeholder">
        <i class="fas fa-map-marked-alt fa-5x"></i>
        <h3>Map View Coming Soon</h3>
        <p>Google Maps integration will be available in a future update</p>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="!isLoading && !showEmptyState && totalPages > 1">
    <div class="pagination">
      <button
        class="pagination-btn"
        (click)="previousPage()"
        [disabled]="currentPage === 1"
      >
        <i class="fas fa-chevron-left"></i>
        Previous
      </button>

      <div class="pagination-pages">
        <button
          *ngIf="currentPage > 3"
          class="pagination-page"
          (click)="goToPage(1)"
        >
          1
        </button>
        <span *ngIf="currentPage > 4" class="pagination-ellipsis">...</span>

        <button
          *ngFor="let page of pages"
          class="pagination-page"
          [class.active]="page === currentPage"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>

        <span *ngIf="currentPage < totalPages - 3" class="pagination-ellipsis">...</span>
        <button
          *ngIf="currentPage < totalPages - 2"
          class="pagination-page"
          (click)="goToPage(totalPages)"
        >
          {{ totalPages }}
        </button>
      </div>

      <button
        class="pagination-btn"
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
      >
        Next
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>

    <div class="pagination-info">
      Page {{ currentPage }} of {{ totalPages }} ({{ totalProjects }} total projects)
    </div>
  </div>
</div>
